<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Carbon Pulse Elite</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #061111; color: #e0f2f1; }
        @keyframes float { 0%, 100% { transform: translateY(0) rotate(0deg); } 50% { transform: translateY(-15px) rotate(1deg); } }
        .floating-box { animation: float 5s ease-in-out infinite; }
        .impact-card { perspective: 1000px; height: 160px; }
        .impact-card-inner { position: relative; width: 100%; height: 100%; transition: transform 0.8s cubic-bezier(0.4, 0, 0.2, 1); transform-style: preserve-3d; cursor: pointer; }
        .impact-card:hover .impact-card-inner { transform: rotateY(180deg); }
        .card-front, .card-back { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; border-radius: 24px; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 20px; box-sizing: border-box; }
        .card-front { background: #0e2525; border: 1px dashed #2a5a5a; }
        .card-back { background: #2d1a1a; color: #ff8a80; transform: rotateY(180deg); border: 1px solid #ff5252; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        const API_URL = 'http://localhost:5000';

        const Icons = {
            Transport: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9C18.7 10.6 16 10 16 10s-1.3-1.4-2.2-2.3c-.5-.4-1.1-.7-1.8-.7H5c-1.1 0-2 .9-2 2v7c0 1.1.9 2 2 2h10"/><circle cx="7" cy="17" r="2"/><circle cx="17" cy="17" r="2"/></svg>,
            Food: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M18 8h1a4 4 0 0 1 0 8h-1"/><path d="M2 8h16v9a4 4 0 0 1-4 4H6a4 4 0 0 1-4-4V8z"/><line x1="6" y1="1" x2="6" y2="4"/><line x1="10" y1="1" x2="10" y2="4"/><line x1="14" y1="1" x2="14" y2="4"/></svg>,
            Digital: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="2" y="3" width="20" height="14" rx="2" ry="2"/><line x1="8" y1="21" x2="16" y2="21"/><line x1="12" y1="17" x2="12" y2="21"/></svg>,
            Home: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>,
            Shopping: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z"/><line x1="3" y1="6" x2="21" y2="6"/><path d="M16 10a4 4 0 0 1-8 0"/></svg>,
            Tree: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M12 19V5M5 11l7-7 7 7M5 19l7-7 7 7"/></svg>
        };

        const impactData = [
            { title: "ðŸŒ¡ï¸ Heatwaves", text: "Rising CO2 levels trap heat, leading to record wildfires and habitability loss." },
            { title: "ðŸŒŠ Arctic Ice", text: "Arctic summer sea ice is shrinking by 12.6% per decade due to warmer oceans." },
            { title: "ðŸš Acidic Seas", text: "The ocean absorbs 30% of CO2, making it acidic and destroying coral reefs." },
            { title: "ðŸŒªï¸ Storms", text: "Warmer air holds more water, causing hurricanes with 10% more destructive rain." },
            { title: "ðŸ¦‹ Extinction", text: "Climate change is forcing species to migrate faster than they can adapt." }
        ];

        function App() {
            const [factors, setFactors] = useState(null);
            const [activeTab, setActiveTab] = useState(null);
            const [currentResult, setCurrentResult] = useState(null);
            const [logs, setLogs] = useState([]);
            const [error, setError] = useState(null);

            useEffect(() => {
                fetch(`${API_URL}/get-factors`)
                    .then(res => res.json())
                    .then(setFactors)
                    .catch(() => setError("Backend disconnected. Run 'flask --app api run'"));
            }, []);

            const totalCarbon = useMemo(() => logs.reduce((acc, l) => acc + (l.footprint_kg || 0), 0), [logs]);
            const treesNeeded = Math.ceil(totalCarbon / 21);

            const calculate = async (endpoint, payload, category) => {
                setCurrentResult(null);
                try {
                    const response = await fetch(`${API_URL}${endpoint}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload),
                    });
                    const data = await response.json();
                    setCurrentResult({ ...data, category });
                } catch (err) { setError("Calculation failed."); }
            };

            const addLog = () => {
                if (currentResult) {
                    setLogs([...logs, { ...currentResult, id: Date.now() }]);
                    setCurrentResult(null);
                }
            };

            if (!factors) return (
                <div className="flex flex-col items-center justify-center min-h-screen">
                    <div className="w-12 h-12 border-4 border-[#64ffda] border-t-transparent rounded-full animate-spin mb-4"></div>
                    <h1 className="text-xl font-bold tracking-widest uppercase text-[#64ffda]">Connecting to Pulse...</h1>
                </div>
            );

            return (
                <div className="max-w-6xl mx-auto px-6 pt-12">
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mb-12">
                        <div className="bg-[#0e2525] p-8 rounded-[32px] border border-[#1a3a3a] shadow-2xl text-center">
                            <p className="text-[10px] font-black uppercase tracking-[0.3em] text-[#8892b0] mb-2">Total Carbon Pulse</p>
                            <h2 className="text-6xl font-black text-[#64ffda]">{totalCarbon.toFixed(1)} <span className="text-xl">kg</span></h2>
                        </div>
                        <div className="bg-[#0e2525] p-8 rounded-[32px] border border-[#1a3a3a] flex items-center justify-between shadow-2xl">
                            <div>
                                <p className="text-[10px] font-black uppercase tracking-[0.3em] text-[#8892b0] mb-2">Nature Offset</p>
                                <h2 className="text-4xl font-black text-white">{treesNeeded} <span className="text-lg">Trees</span></h2>
                                <p className="text-xs text-[#64ffda] mt-1">Needed for Net Zero</p>
                            </div>
                            <div className="text-[#64ffda]"><Icons.Tree /></div>
                        </div>
                    </div>

                    <div className="flex flex-col items-center mb-16">
                        <div className="floating-box bg-[#142828] bg-opacity-40 backdrop-blur-2xl border-2 border-[#64ffda] px-12 py-6 rounded-[30px] shadow-[0_0_50px_rgba(100,255,218,0.2)] mb-10">
                            <h1 className="text-5xl font-black text-white tracking-tighter text-center">Carbon Pulse </h1>
                        </div>

                        <div className="grid grid-cols-2 md:grid-cols-5 gap-4 w-full max-w-5xl">
                            <Tab id="transport" label="Transport" icon={<Icons.Transport />} active={activeTab} set={setActiveTab} />
                            <Tab id="food" label="Food" icon={<Icons.Food />} active={activeTab} set={setActiveTab} />
                            <Tab id="digital" label="Digital" icon={<Icons.Digital />} active={activeTab} set={setActiveTab} />
                            <Tab id="home" label="Energy" icon={<Icons.Home />} active={activeTab} set={setActiveTab} />
                            <Tab id="shopping" label="Shopping" icon={<Icons.Shopping />} active={activeTab} set={setActiveTab} />
                        </div>

                        <div className="w-full flex flex-col items-center mt-12">
                            {activeTab === 'transport' && <InputForm factors={factors.transport} label="Distance (km)" onCalc={(m, v) => calculate('/calculate/transport', {mode: m, distance: v}, 'Transport')} />}
                            {activeTab === 'food' && <InputForm factors={factors.food_by_meal} label="Meals" onCalc={(m, v) => calculate('/calculate/food', {meal_type: m, meal_count: v}, 'Food')} />}
                            {activeTab === 'digital' && <InputForm factors={factors.digital} label="Usage (Hrs/GB)" onCalc={(m, v) => calculate('/calculate/digital', {activity: m, quantity: v}, 'Digital')} />}
                            {activeTab === 'home' && <InputForm factors={factors.home_energy} label="Units" onCalc={(m, v) => calculate('/calculate/home_energy', {energy_type: m, monthly_usage: v}, 'Energy')} />}
                            {activeTab === 'shopping' && <ShoppingForm factors={factors.shopping_total_footprint} onCalc={v => calculate('/calculate/shopping', v, 'Shopping')} />}
                        </div>

                        {currentResult && (
                            <div className="mt-8 bg-[#1a4a4a] border-4 border-[#64ffda] p-8 rounded-[40px] w-full max-w-xl text-center shadow-2xl">
                                <h3 className="text-5xl font-black text-white mb-2">+{currentResult.footprint_kg} kg</h3>
                                <button onClick={addLog} className="w-full mt-4 py-4 rounded-2xl bg-[#64ffda] text-[#061111] font-black text-xl hover:bg-white transition-all">LOG TO PULSE</button>
                            </div>
                        )}
                    </div>

                    <h2 className="text-[#64ffda] text-3xl font-black text-center mb-8 tracking-widest uppercase">The Ripple Effect</h2>
                    <div className="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-6 mb-20">
                        {impactData.map((item, index) => (
                            <div key={index} className="impact-card">
                                <div className="impact-card-inner">
                                    <div className="card-front"><h4 className="font-bold text-[#64ffda]">{item.title}</h4></div>
                                    <div className="card-back"><p className="text-xs">{item.text}</p></div>
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            );
        }

        function Tab({ id, label, icon, active, set }) {
            const selected = active === id;
            return (
                <button onClick={() => set(id)} className={`flex flex-col items-center justify-center p-6 rounded-[28px] border-2 transition-all ${selected ? 'bg-[#1a4a4a] border-[#64ffda] shadow-[0_0_20px_#64ffda44]' : 'bg-[#0e2525] border-[#1a3a3a] opacity-60'}`}>
                    <div className={`mb-3 ${selected ? 'text-[#64ffda]' : 'text-[#8892b0]'}`}>{icon}</div>
                    <span className="text-[10px] font-black uppercase tracking-tighter">{label}</span>
                </button>
            );
        }

        function InputForm({ factors, label, onCalc }) {
            const [m, setM] = useState(Object.keys(factors)[0]);
            const [v, setV] = useState(0);
            return (
                <form className="bg-[#0e2525] p-10 rounded-[40px] border border-[#1a3a3a] w-full max-w-lg shadow-2xl" onSubmit={e => { e.preventDefault(); onCalc(m, v); }}>
                    <div className="mb-6">
                        <label className="text-[10px] font-bold uppercase text-[#8892b0] mb-2 block">Category</label>
                        <select value={m} onChange={e => setM(e.target.value)} className="w-full bg-[#061111] p-4 rounded-xl border border-[#1a3a3a] text-[#64ffda] outline-none">
                            {Object.keys(factors).map(k => <option key={k} value={k}>{k}</option>)}
                        </select>
                    </div>
                    <div className="mb-6">
                        <label className="text-[10px] font-bold uppercase text-[#8892b0] mb-2 block">{label}</label>
                        <input type="number" step="0.1" value={v} onChange={e => setV(e.target.value)} className="w-full bg-[#061111] p-4 rounded-xl border border-[#1a3a3a] text-white outline-none" />
                    </div>
                    <button className="w-full bg-[#1a4a4a] border-2 border-[#64ffda] text-[#64ffda] py-4 rounded-xl font-bold">ANALYZE</button>
                </form>
            );
        }

        function ShoppingForm({ factors, onCalc }) {
            const [t, setT] = useState(Object.keys(factors)[0]);
            const [c, setC] = useState(1);
            const [l, setL] = useState(365);
            return (
                <form className="bg-[#0e2525] p-10 rounded-[40px] border border-[#1a3a3a] w-full max-w-lg shadow-2xl" onSubmit={e => { e.preventDefault(); onCalc({item_type: t, item_count: c, lifespan_days: l}); }}>
                    <div className="mb-4"><label className="text-[10px] font-bold text-[#8892b0] uppercase">Type</label><select value={t} onChange={e => setT(e.target.value)} className="w-full bg-[#061111] p-4 rounded-xl border border-[#1a3a3a] text-[#64ffda]">{Object.keys(factors).map(k => <option key={k} value={k}>{k}</option>)}</select></div>
                    <div className="grid grid-cols-2 gap-4 mb-6">
                        <div><label className="text-[10px] font-bold text-[#8892b0] uppercase">Qty</label><input type="number" value={c} onChange={e => setC(e.target.value)} className="w-full bg-[#061111] p-4 rounded-xl border border-[#1a3a3a] text-white" /></div>
                        <div><label className="text-[10px] font-bold text-[#8892b0] uppercase">Days</label><input type="number" value={l} onChange={e => setL(e.target.value)} className="w-full bg-[#061111] p-4 rounded-xl border border-[#1a3a3a] text-white" /></div>
                    </div>
                    <button className="w-full bg-[#1a4a4a] border-2 border-[#64ffda] text-[#64ffda] py-4 rounded-xl font-bold">ANALYZE ASSET</button>
                </form>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>